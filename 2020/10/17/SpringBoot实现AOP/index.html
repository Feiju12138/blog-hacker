<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【笔记】SpringBoot实现AOP | 绯鞠的博客 | 连蜜统治世界!!!💕</title>

  
  <meta name="author" content="绯鞠">
  

  
  <meta name="description" content="捕捉一只爱折腾的绯鞠">
  

  
  
  <meta name="keywords" content="Java,Spring,SpringBoot,AOP">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="【笔记】SpringBoot实现AOP"/>

  <meta property="og:site_name" content="绯鞠的博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="绯鞠的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">绯鞠的博客</a>
    </h1>
    <p class="site-description">连蜜统治世界!!!💕</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/about/">关于</a></li>
      
        <li><a href="/tags/">标签</a></li>
      
        <li><a href="/categories/">分类</a></li>
      
        <li><a href="/archives/">归档</a></li>
      
        <li><a href="/links/">友链</a></li>
      
        <li><a href="/reward/">赞助</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
        <li><a target="_blank" rel="noopener" href="//stellar.loli.fj.cn">主题</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>【笔记】SpringBoot实现AOP</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/10/17/SpringBoot实现AOP/" rel="bookmark">
        <time class="entry-date published" datetime="2020-10-17T09:24:56.000Z">
          2020-10-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在SpringBoot项目中基于AspectJ框架实现的AOP学习笔记</p>
<span id="more"></span>

<h2 id="AOP介绍"><a href="#AOP介绍" class="headerlink" title="AOP介绍"></a>AOP介绍</h2><ul>
<li>面向切面的程序设计（Aspect-oriented programming，AOP，又译作面向方面的程序设计、剖面导向程序设计）是计算机科学中的一种程序设计思想，旨在将横切关注点与业务主体进行进一步分离，以提高程序代码的模块化程度。通过在现有代码基础上增加额外的通知（Advice）机制，能够对被声明为“切点（Pointcut）”的代码块进行统一管理与装饰，如“对所有方法名以‘set*’开头的方法添加后台日志”。该思想使得开发人员能够将与代码核心业务逻辑关系不那么密切的功能（如日志功能）添加至程序中，同时又不降低业务代码的可读性。面向切面的程序设计思想也是面向切面软件开发的基础。（<a href="/302.html?target=https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%9A%84%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">维基百科</a>）</li>
</ul>
<h2 id="代理方式与配置"><a href="#代理方式与配置" class="headerlink" title="代理方式与配置"></a>代理方式与配置</h2><ul>
<li><p>在SpringBoot项目中有两种代理对象可以实现AOP，一个是JDK代理，一个是CGLIB代理</p>
</li>
<li><p>CGLIB代理为SpringAOP的默认代理对象，它的原理是为目标方法所在的类实现一个子类，通过继承关系实现AOP</p>
</li>
<li><p>JDK代理的原理是为目标方法所在的类实现一个兄弟类（也就是说目标方法所在的类必须发生了继承关系，且为子类），JDK代理会实现与目标方法所在的类对应父类的继承关系，从而实现AOP，但JDK代理需要修改SpringBoot配置文件，以yml为例</p>
</li>
<li><p>配置的值默认为true表示CGLIB代理，改为false表示JDK代理</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.aop.proxy-target-class</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">aop:</span></span><br><span class="line">    <span class="attr">proxy-target-class:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="实现AOP"><a href="#实现AOP" class="headerlink" title="实现AOP"></a>实现AOP</h2><h3 id="定义一个切面"><a href="#定义一个切面" class="headerlink" title="定义一个切面"></a>定义一个切面</h3><ul>
<li>通过@Aspect定义一个切面类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysLogAspect</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="定义切面的优先级"><a href="#定义切面的优先级" class="headerlink" title="定义切面的优先级"></a>定义切面的优先级</h4><blockquote>
<p><code>@Order()</code>：用于描述切面类，数字越小，优先级越高，可以是负数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysLogAspect</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在切面中定义切入点"><a href="#在切面中定义切入点" class="headerlink" title="在切面中定义切入点"></a>在切面中定义切入点</h3><h4 id="通过注解的方式定义切入点"><a href="#通过注解的方式定义切入点" class="headerlink" title="通过注解的方式定义切入点"></a>通过注解的方式定义切入点</h4><ul>
<li><p>通过匹配有指定自定义注解描述的方法，实现细粒度的切入点表达式定义</p>
</li>
<li><p>首先定义一个自定义注解</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequiredLog &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>&lt;package&gt;.&lt;required&gt;</code>：注解的全局限定名<br><code>doLog()</code>：该方法仅仅是注解的一个载体，方法体内不需要写任何内容</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@annotation(&lt;package&gt;.&lt;required&gt;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>为切入点方法标注自定义注解</li>
</ul>
<h4 id="通过指定bean的方式定义切入点"><a href="#通过指定bean的方式定义切入点" class="headerlink" title="通过指定bean的方式定义切入点"></a>通过指定bean的方式定义切入点</h4><ul>
<li>通过bean表达式为Spring中的一种粗粒度的切入点表达式，不能精确到具体的方法</li>
</ul>
<blockquote>
<p><code>&lt;bean&gt;</code>：Spring容器中一个bean对象的名字</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;bean(&lt;bean&gt;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="匹配更多的bean对象"><a href="#匹配更多的bean对象" class="headerlink" title="匹配更多的bean对象"></a>匹配更多的bean对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;bean(*&lt;bean&gt;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通过指定类名的方式定义切入点"><a href="#通过指定类名的方式定义切入点" class="headerlink" title="通过指定类名的方式定义切入点"></a>通过指定类名的方式定义切入点</h4><ul>
<li>通过指定类名的方式定义切入点，实现粗粒度的切入点表达式定义</li>
</ul>
<blockquote>
<p><code>&lt;package&gt;.&lt;class&gt;</code>：类的全局限定名</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;within(&lt;package&gt;.&lt;class&gt;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="指定当前目录下的所有类的所有方法"><a href="#指定当前目录下的所有类的所有方法" class="headerlink" title="指定当前目录下的所有类的所有方法"></a>指定当前目录下的所有类的所有方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;within(&lt;package&gt;.*)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="指定当前目录以及子目录中类的所有方法"><a href="#指定当前目录以及子目录中类的所有方法" class="headerlink" title="指定当前目录以及子目录中类的所有方法"></a>指定当前目录以及子目录中类的所有方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;within(&lt;package&gt;..*)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通过指定方法的方式定义切入点"><a href="#通过指定方法的方式定义切入点" class="headerlink" title="通过指定方法的方式定义切入点"></a>通过指定方法的方式定义切入点</h4><ul>
<li>通过指定方法的方式定义切入点，实现细粒度的切入点表达式定义</li>
</ul>
<h5 id="匹配无参方法"><a href="#匹配无参方法" class="headerlink" title="匹配无参方法"></a>匹配无参方法</h5><blockquote>
<p><code>void</code>：方法返回值类型<br><code>&lt;package&gt;.&lt;class&gt;.&lt;method&gt;()</code>：方法全局限定名</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(void &lt;package&gt;.&lt;class&gt;.&lt;method&gt;())&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="匹配有参方法"><a href="#匹配有参方法" class="headerlink" title="匹配有参方法"></a>匹配有参方法</h5><blockquote>
<p><code>String</code>：参数类型</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(void &lt;package&gt;.&lt;class&gt;.&lt;method&gt;(String))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doLog</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="为切入点定义通知方法"><a href="#为切入点定义通知方法" class="headerlink" title="为切入点定义通知方法"></a>为切入点定义通知方法</h3><h4 id="通知的类型"><a href="#通知的类型" class="headerlink" title="通知的类型"></a>通知的类型</h4><blockquote>
<p><code>@Around</code>：通过该注解描述的方法可以在目标方法执行之前和之后做功能扩展，在@Around注解描述的方法内部，可以手动调用目标方法</p>
<blockquote>
<p>对于<code>@Around</code>注解描述的方法其规范要求为</p>
<blockquote>
<p>返回值类型为：Object<br>参数类型为：ProceedingJoinPoint<br>抛出的异常为：Throwable</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<p><code>@Before</code>：在目标方法执行之前执行<br><code>@After</code>：在目标方法结束之后执行<br><code>@AfterReturning</code>：在目标方法正常结束之前执行<br><code>@AfterThrowing</code>、<code>@AfterThrowing(value=&quot;&quot;,throwing=&quot;e&quot;)</code>：在目标方法异常结束之前执行</p>
</blockquote>
<h4 id="通知类型的顺序"><a href="#通知类型的顺序" class="headerlink" title="通知类型的顺序"></a>通知类型的顺序</h4><blockquote>
<p><code>正常执行顺序</code>：<code>@Around.before</code>-&gt;<code>@Before</code>-&gt;<code>@Around.after</code>-&gt;<code>@After</code>-&gt;<code>@AfterReturning</code><br><code>异常执行顺序</code>：<code>@Around.before</code>-&gt;<code>@Before</code>-&gt;<code>@Around.error</code>-&gt;<code>@After</code>-&gt;<code>@AfterThrowing</code></p>
</blockquote>
<h4 id="定义通知方法"><a href="#定义通知方法" class="headerlink" title="定义通知方法"></a>定义通知方法</h4><h5 id="直接在advice内部定义切入点表达式"><a href="#直接在advice内部定义切入点表达式" class="headerlink" title="直接在advice内部定义切入点表达式"></a>直接在advice内部定义切入点表达式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;@annotation(com.RequiredLog)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    proceedingJoinPoint.proceed();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="在advice内部通过方法引用定义切入点表达式"><a href="#在advice内部通过方法引用定义切入点表达式" class="headerlink" title="在advice内部通过方法引用定义切入点表达式"></a>在advice内部通过方法引用定义切入点表达式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;doLog()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    proceedingJoinPoint.proceed();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试Demo"><a href="#测试Demo" class="headerlink" title="测试Demo"></a>测试Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SysTimeAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;bean(sysUserServiceImpl)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doTime</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;doTime()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">(JoinPoint jp)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;@Before&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After(&quot;doTime()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfter</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;@After&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;doTime()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;@AfterReturning&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;doTime()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;@AfterThrowing&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Around(&quot;doTime()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint jp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;@Around.before&quot;</span>);</span><br><span class="line">            Object obj=jp.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;@Around.after&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;@Around.exception&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;@Around.finally&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Java后端学习指北/">Java后端学习指北</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java/">Java</a><a href="/tags/Spring/">Spring</a><a href="/tags/SpringBoot/">SpringBoot</a><a href="/tags/AOP/">AOP</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 绯鞠
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>