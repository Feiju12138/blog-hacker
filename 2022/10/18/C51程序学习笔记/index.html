<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【笔记】C51程序学习笔记 | 绯鞠的博客 | 连蜜统治世界!!!💕</title>

  
  <meta name="author" content="绯鞠">
  

  
  <meta name="description" content="捕捉一只爱折腾的绯鞠">
  

  
  
  <meta name="keywords" content="Microcontroller">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="【笔记】C51程序学习笔记"/>

  <meta property="og:site_name" content="绯鞠的博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="绯鞠的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">绯鞠的博客</a>
    </h1>
    <p class="site-description">连蜜统治世界!!!💕</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/about/">关于</a></li>
      
        <li><a href="/tags/">标签</a></li>
      
        <li><a href="/categories/">分类</a></li>
      
        <li><a href="/archives/">归档</a></li>
      
        <li><a href="/links/">友链</a></li>
      
        <li><a href="/reward/">赞助</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
        <li><a target="_blank" rel="noopener" href="//stellar.loli.fj.cn">主题</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>【笔记】C51程序学习笔记</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2022/10/18/C51程序学习笔记/" rel="bookmark">
        <time class="entry-date published" datetime="2022-10-18T08:33:18.000Z">
          2022-10-18
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Windows上标准51单片机的C51学习笔记<br>注意：本文所有代码均按照sdcc编译器代码规范编写，如果使用的Keli编译器，需要自行修改代码</p>
<span id="more"></span>

<h2 id="存储空间的访问"><a href="#存储空间的访问" class="headerlink" title="存储空间的访问"></a>存储空间的访问</h2><ul>
<li><p>单片机有两个存储器，分别是：只读存储器ROM、随机存储器RAM</p>
<ul>
<li>ROM：通常用于存程序（code）</li>
<li>RAM：通常用于存数据（data）</li>
</ul>
</li>
<li><p>51单片机存储器的空间</p>
<ul>
<li>标准51单片机<ul>
<li>ROM空间为4KB</li>
<li>RAM空间为128B</li>
</ul>
</li>
<li>STC12C5A60S2单片机<ul>
<li>ROM空间（4KB）+外扩内存（56KB）总共为60KB</li>
<li>RAM空间为1280B</li>
</ul>
</li>
</ul>
</li>
<li><p>C语言中的变量值将会默认存入RAM</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为RAM容量较小，所以如果有大量数据需要存储（例如数组），可以通过<code>code</code>关键字强制将变量的值存入ROM</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__code <span class="type">int</span> a = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果使用的是增强型51单片机（例如STC12C5A60S2单片机），可以通过<code>xdata</code>关键字强制将变量的值存入外扩内存</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__xdata <span class="type">int</span> a = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="操作2进制位"><a href="#操作2进制位" class="headerlink" title="操作2进制位"></a>操作2进制位</h2><ul>
<li>在操作2进制位时，如果需要改变2进制位，通常不使用算术运算符，通常使用<a href="/2022/11/04/C%E8%AF%AD%E8%A8%80%E6%8C%89%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/">按位运算符</a></li>
</ul>
<h3 id="指定位为0"><a href="#指定位为0" class="headerlink" title="指定位为0"></a>指定位为0</h3><ul>
<li>任意位与0相<strong>与</strong>，结果<strong>不变</strong></li>
<li>任意位与1相<strong>与</strong>，结果为<strong>0</strong></li>
</ul>
<p>举例：将末位置0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = num &amp; <span class="number">0b00000001</span>;</span><br></pre></td></tr></table></figure>

<h3 id="指定位为1"><a href="#指定位为1" class="headerlink" title="指定位为1"></a>指定位为1</h3><ul>
<li>任意位与0相<strong>或</strong>，结果<strong>不变</strong></li>
<li>任意位与1相<strong>或</strong>，结果为<strong>1</strong></li>
</ul>
<p>举例：将末位置1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = num | <span class="number">0b00000001</span>;</span><br></pre></td></tr></table></figure>

<h3 id="指定位取反"><a href="#指定位取反" class="headerlink" title="指定位取反"></a>指定位取反</h3><ul>
<li>任意位与0<strong>异或</strong>，结果<strong>不变</strong></li>
<li>任意位与1<strong>异或</strong>，结果<strong>取反</strong></li>
</ul>
<p>举例：将末位置取反</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = num ^ <span class="number">0b00000001</span>;</span><br></pre></td></tr></table></figure>

<h2 id="固定格式"><a href="#固定格式" class="headerlink" title="固定格式"></a>固定格式</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="引入头文件"><a href="#引入头文件" class="headerlink" title="引入头文件"></a>引入头文件</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="为引脚赋值"><a href="#为引脚赋值" class="headerlink" title="为引脚赋值"></a>为引脚赋值</h2><ul>
<li>I&#x2F;O端口都是可以位寻址的，所以既可以按字节赋值，也可以按位赋值</li>
</ul>
<h3 id="按字节赋值"><a href="#按字节赋值" class="headerlink" title="按字节赋值"></a>按字节赋值</h3><ul>
<li>将P0的所有引脚都通电（<code>00000000</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0 = <span class="number">0x00</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>将P0的所有引脚都断电（<code>11111111</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0 = <span class="number">0xFF</span>;</span><br></pre></td></tr></table></figure>


<h3 id="按位赋值"><a href="#按位赋值" class="headerlink" title="按位赋值"></a>按位赋值</h3><ul>
<li>将P0的第1个引脚通电（<code>11111110</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0_0 = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>将P0的第1个引脚断电（<code>11111111</code>）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P0_0 = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="循环语句提升效率"><a href="#循环语句提升效率" class="headerlink" title="循环语句提升效率"></a>循环语句提升效率</h2><ul>
<li>循环要以递减的方式迭代。在编译成汇编代码后，递减的方式迭代要比递增的方式迭代执行效率更高</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> i = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">while</span> (i &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    i--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">100</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="发光二极管"><a href="#发光二极管" class="headerlink" title="发光二极管"></a>发光二极管</h2><ul>
<li>发光二极管是一个输出外设</li>
</ul>
<h3 id="拉电流和灌电流"><a href="#拉电流和灌电流" class="headerlink" title="拉电流和灌电流"></a>拉电流和灌电流</h3><h4 id="拉电流"><a href="#拉电流" class="headerlink" title="拉电流"></a>拉电流</h4><ul>
<li>拉电流时<ul>
<li>输入为<strong>1</strong>时，发光二极管<strong>亮灯</strong></li>
<li>输入为<strong>0</strong>时，发光二极管<strong>不亮灯</strong></li>
</ul>
</li>
<li>拉电流为200微安</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">单片机引脚 &lt;- 发光二极管正级</span><br><span class="line">发光二极管负级 -&gt; 限流电阻 -&gt; 电源负级</span><br></pre></td></tr></table></figure>

<h4 id="灌电流"><a href="#灌电流" class="headerlink" title="灌电流"></a>灌电流</h4><ul>
<li>灌电流时<ul>
<li>输入为<strong>0</strong>时，发光二极管<strong>亮灯</strong></li>
<li>输入为<strong>1</strong>时，发光二极管<strong>不亮灯</strong></li>
</ul>
</li>
<li>灌电流为20毫安，所以通常使用灌电流，才能让发光二极管达到正常亮度</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">单片机引脚 &lt;- 限流电阻 &lt;- 发光二极管负级</span><br><span class="line">发光二极管正级 -&gt; 电源正级</span><br></pre></td></tr></table></figure>

<h3 id="软件延迟函数"><a href="#软件延迟函数" class="headerlink" title="软件延迟函数"></a>软件延迟函数</h3><ul>
<li>通过600~700次的空循环，可以实现延迟1ms左右</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过延迟实现闪烁"><a href="#通过延迟实现闪烁" class="headerlink" title="通过延迟实现闪烁"></a>通过延迟实现闪烁</h3><ul>
<li>频率越高闪烁越快</li>
<li>每1s内，实现1次亮和1次灭，这样的频率为1Hz</li>
<li>因为人眼有余晖时间，所以人眼可识别的最大闪烁频率为50Hz</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 闪烁频率为50Hz（1秒钟闪烁50次）</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> time = <span class="number">1</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> count = <span class="number">50</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> delay_time = <span class="number">1000</span> * time / <span class="number">2</span> / count;</span><br><span class="line">        P1_0 = <span class="number">0</span>;</span><br><span class="line">        delay(delay_time);</span><br><span class="line">        P1_0 = <span class="number">1</span>;</span><br><span class="line">        delay(delay_time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过调整占空比改变亮度"><a href="#通过调整占空比改变亮度" class="headerlink" title="通过调整占空比改变亮度"></a>通过调整占空比改变亮度</h3><ul>
<li>亮度的决定因素：发光二极管闪烁时，亮的时间越大，灭的时间越小，亮度越亮</li>
<li>占空比：灭的时间 &#x2F; 亮的时间 + 灭的时间</li>
<li>当亮和灭的时间间隔发生改变时，占空比就会改变，发光二极管亮度就会改变</li>
<li>50Hz在1秒内的的两次间隔之和为20ms，所以能产生19级亮度<ul>
<li>当亮1ms，灭19ms，亮度最暗</li>
<li>当亮19ms，灭1ms，亮度最亮</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 亮度最亮</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">    P1_0 = <span class="number">0</span>;</span><br><span class="line">    delay(<span class="number">19</span>);</span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    delay(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 亮度最暗</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">mim</span><span class="params">()</span> &#123;</span><br><span class="line">    P1_0 = <span class="number">0</span>;</span><br><span class="line">    delay(<span class="number">1</span>);</span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    delay(<span class="number">19</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="STC12C5A60S2的特殊功能寄存器"><a href="#STC12C5A60S2的特殊功能寄存器" class="headerlink" title="STC12C5A60S2的特殊功能寄存器"></a>STC12C5A60S2的特殊功能寄存器</h2><h3 id="引入头文件-1"><a href="#引入头文件-1" class="headerlink" title="引入头文件"></a>引入头文件</h3><p><a href="/2022/10/28/STC12C5A60S2%E5%A4%B4%E6%96%87%E4%BB%B6%E6%BA%90%E4%BB%A3%E7%A0%81/">传送门</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;STC12C5A60S2.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="切换端口工作模式"><a href="#切换端口工作模式" class="headerlink" title="切换端口工作模式"></a>切换端口工作模式</h3><ul>
<li>以修改P0端口的第0个位置为例</li>
</ul>
<h4 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h4><table>
<thead>
<tr>
<th>工作模式</th>
<th>M1寄存器的值</th>
<th>M0寄存器的值</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>标准双向口模式（缺省值）</td>
<td>0</td>
<td>0</td>
<td>灌电流为20毫安，拉电流为200微安</td>
</tr>
<tr>
<td>强推挽输出模式（强推模式）</td>
<td>0</td>
<td>1</td>
<td>灌电流为20毫安，拉电流提升为20毫安</td>
</tr>
<tr>
<td>开漏模式</td>
<td>1</td>
<td>0</td>
<td>-</td>
</tr>
<tr>
<td>高阻模式</td>
<td>1</td>
<td>1</td>
<td>-</td>
</tr>
</tbody></table>
<h4 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h4><ul>
<li>每个位可以单独设置工作模式，由2个寄存器对应位的值决定</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">P0M1 = <span class="number">0x00</span>;</span><br><span class="line">P0M0 = <span class="number">0x00</span>;</span><br></pre></td></tr></table></figure>

<h2 id="按键"><a href="#按键" class="headerlink" title="按键"></a>按键</h2><ul>
<li><p>按键是一个输入外设</p>
</li>
<li><p>按键<strong>按下</strong>时，输入为<strong>0</strong></p>
</li>
<li><p>按键<strong>没有按下</strong>时，输入为<strong>1</strong></p>
</li>
</ul>
<h3 id="软件消抖"><a href="#软件消抖" class="headerlink" title="软件消抖"></a>软件消抖</h3><ul>
<li>按键按下和抬起时，会有抖动现象产生，抖动现象通常会在按下和抬起的10ms~20ms之间发生</li>
<li>软件消抖通过利用软件延迟函数实现</li>
<li>软件消抖的效果<ul>
<li>按下消抖效果：按下时进入循环，此时通过延迟10ms，解决10ms之内按下瞬间出现反复按的情况。</li>
<li>抬起消抖效果：如果按住并且一直没抬起，此时会进入无限循环，也就是不会做处理。抬起时通过延迟10ms，解决10ms之内按下瞬间出现反复按的情况</li>
</ul>
</li>
</ul>
<h4 id="按下后执行业务"><a href="#按下后执行业务" class="headerlink" title="按下后执行业务"></a>按下后执行业务</h4><blockquote>
<p><code>P0_0</code>：按键的连接点</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) </span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="keyword">while</span> (!P0_0)</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="comment">// 按下消抖</span></span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">if</span> (!P0_0)</span><br><span class="line">            &#123;   </span><br><span class="line">                <span class="comment">// 业务代码</span></span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 抬起消抖</span></span><br><span class="line">            <span class="keyword">while</span> (!P0_0);</span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="抬起后执行业务"><a href="#抬起后执行业务" class="headerlink" title="抬起后执行业务"></a>抬起后执行业务</h4><blockquote>
<p><code>P0_0</code>：按键的连接点</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) </span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="keyword">while</span> (!P0_0)</span><br><span class="line">        &#123;   </span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">while</span> (!P0_0);</span><br><span class="line">            delay(<span class="number">10</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 业务代码</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;   </span><br><span class="line"></span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="按键检测函数"><a href="#按键检测函数" class="headerlink" title="按键检测函数"></a>按键检测函数</h3><ul>
<li>为每一个按键按下赋予键值，在主函数中通过判断减值，实现指定业务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include&lt;8052.h&gt;</span></span><br><span class="line"></span><br><span class="line">void delay(unsigned int ms)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int j;</span><br><span class="line">    while (ms--)</span><br><span class="line">        for (j = 600; j &gt; 0; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned char key_scan(void)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char key_num = 0;</span><br><span class="line">    if (!P0_0 || !P0_1)</span><br><span class="line">    &#123;   </span><br><span class="line">        delay(10);</span><br><span class="line">        if (!P0_0) key_num = 1;</span><br><span class="line">        if (!P0_1) key_num = 2;</span><br><span class="line">        while (!P0_0 || !P0_1);</span><br><span class="line">        delay(10);</span><br><span class="line">    &#125;   </span><br><span class="line">    return key_num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">    while (1) </span><br><span class="line">    &#123;   </span><br><span class="line">        switch (key_scan())</span><br><span class="line">        &#123;   </span><br><span class="line">            case 1:</span><br><span class="line">                // 业务代码</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                // 业务代码</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七段数码管"><a href="#七段数码管" class="headerlink" title="七段数码管"></a>七段数码管</h2><ul>
<li><p>数码管的引脚一般都在上下，共阴和共阳是由内部决定的</p>
</li>
<li><p>共阳数码管（灌电流）点亮：位信号（com端）接高电平，段信号（a、b、c、d、e、f、g、dp端）接低电平</p>
<ul>
<li>本案例接线方式<ul>
<li>位信号1接P0.3、…、位信号4接P0.0</li>
<li>段信号a接P1.0、…、段信号g接P1.6、段信号dep接P1.7</li>
</ul>
</li>
</ul>
</li>
<li><p>共阴数码管（拉电流）点亮：位信号（com端）接低电平，段信号（a、b、c、d、e、f、g、dp端）接高电平</p>
</li>
<li><p>不应该将位信号同时点亮，如果需要全部点亮每个位，可以采用动态刷新技术</p>
</li>
<li><p>不同位数的七段数码管</p>
<ul>
<li>1位七段数码管一共有10个引脚<ul>
<li>2个com端（这两个引脚内部是想通的）</li>
<li>a（上）、b（右上）、c（右下）、d（下）、e（左下）、f（左上）、g（中）、dp（小数点）端</li>
</ul>
</li>
<li>2位七段数码管一共有10个引脚<ul>
<li>com1端、com2端</li>
<li>a（上）、b（右上）、c（右下）、d（下）、e（左下）、f（左上）、g（中）、dp（小数点）端</li>
</ul>
</li>
<li>N位七段数码管一共有<code>(8+N)</code>个引脚<ul>
<li>com1端、…、comN端</li>
<li>a（上）、b（右上）、c（右下）、d（下）、e（左下）、f（左上）、g（中）、dp（小数点）端</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="全部点亮"><a href="#全部点亮" class="headerlink" title="全部点亮"></a>全部点亮</h3><ul>
<li>通过动态扫描（刷新），实现全部点亮检查坏点：通过快速切换不同位上的数字，实现现实多个位上的数字扫描<ul>
<li>因为人眼能识别的最大闪烁频率为50Hz，所以为了骗过人眼，需要将所有数字在20ms内完成闪烁</li>
</ul>
</li>
<li>七段码：每个数字位用于显示数字的16进制值，16进制数的每一位决定哪一个笔划亮灯<ul>
<li>从com端到a~dep端如果是灌电流，则com端输出<strong>0</strong>时，数码管指定位<strong>亮灯</strong></li>
</ul>
</li>
</ul>
<ol>
<li>选位：选位阶段需要指定哪个位亮</li>
<li>送段：送出段信号阶段需要指定亮哪个数字</li>
<li>延迟：如果是4位数码管，每个位的延迟应设置为5ms</li>
<li>灭段：为了解决拖影（拖尾）现象，将亮灯的数字熄灭</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__sfr __at (<span class="number">0x94</span>) P0M0;</span><br><span class="line">__sfr __at (<span class="number">0x93</span>) P0M1;</span><br><span class="line">__sfr __at (<span class="number">0x92</span>) P1M0;</span><br><span class="line">__sfr __at (<span class="number">0x91</span>) P1M1;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 强推挽输出模式</span></span><br><span class="line">    P0M1 = <span class="number">0x00</span>;</span><br><span class="line">    P0M0 = <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义七段码</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xC0</span>, <span class="number">0xEC</span>, <span class="number">0x92</span>, <span class="number">0x98</span>,<span class="number">0xCC</span>, <span class="number">0x89</span>, <span class="number">0x81</span>, <span class="number">0xDC</span>, <span class="number">0x80</span>, <span class="number">0x88</span>&#125;;</span><br><span class="line">    <span class="comment">// 定义位</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> w[] = &#123;<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            P0 = w[i]; <span class="comment">// 选位</span></span><br><span class="line">            P1 = num[<span class="number">8</span>]; <span class="comment">// 送段</span></span><br><span class="line">            delay(<span class="number">5</span>); <span class="comment">// 延迟</span></span><br><span class="line">            P1 = <span class="number">0xFF</span>; <span class="comment">// 灭段</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="封装为函数"><a href="#封装为函数" class="headerlink" title="封装为函数"></a>封装为函数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *arr)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义计数器</span></span><br><span class="line">    <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 定义七段码</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xC0</span>, <span class="number">0xEC</span>, <span class="number">0x92</span>, <span class="number">0x98</span>,<span class="number">0xCC</span>, <span class="number">0x89</span>, <span class="number">0x81</span>, <span class="number">0xDC</span>, <span class="number">0x80</span>, <span class="number">0x88</span>&#125;;</span><br><span class="line">    P0 = <span class="number">0x01</span> &lt;&lt; i;</span><br><span class="line">    P1 = num[arr[i]];</span><br><span class="line">    delay(<span class="number">5</span>);</span><br><span class="line">    P0 = <span class="number">0x00</span>;</span><br><span class="line">    i += <span class="number">1</span>;</span><br><span class="line">    i %= <span class="number">4</span>;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> arr[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        display(arr);</span><br><span class="line">        delay(<span class="number">2</span>);            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="点阵屏"><a href="#点阵屏" class="headerlink" title="点阵屏"></a>点阵屏</h2><ul>
<li><p>8（列）*8（行）的点阵屏的操作逻辑与8位数码管理论上相同</p>
</li>
<li><p>分辨率：8（列）*8（行）</p>
</li>
<li><p>像素：64</p>
</li>
<li><p>点阵屏的引脚是由方向决定的，共阴和共阳也是由方向决定的</p>
</li>
<li><p>共阳（灌电流）接线方式（引脚在左右）点亮：列信号接高电平（高选列），行信号接低电平（低送行）</p>
</li>
<li><p>共阴（拉电流）接线方式（引脚在上下）点亮：列信号接低电平（低选列），行信号接高电平（高送行）</p>
<ul>
<li>本案例接线方式（单屏）<ul>
<li>列信号1接P0.0、…、位信号8接P0.7</li>
<li>行信号1接P1.0、…、段信号8接P1.7</li>
</ul>
</li>
<li>本案例接线方式（多屏）<ul>
<li>列信号1接P0.0、…、位信号8接P0.7</li>
<li>列信号9接P2.0、…、位信号16接P2.7</li>
<li>行信号1接P1.0、…、段信号8接P1.7</li>
</ul>
</li>
</ul>
</li>
<li><p>不应该将列信号同时点亮，如果需要全部点亮每个列，可以采用动态刷新技术</p>
</li>
<li><p>取模：将文字转化成点阵</p>
<ul>
<li>汉字的字模需要最少12*12的分辨率才能正常显示</li>
</ul>
</li>
<li><p>切屏：每次刷新8列</p>
</li>
<li><p>滚屏：每次刷新1列</p>
</li>
</ul>
<h3 id="单屏"><a href="#单屏" class="headerlink" title="单屏"></a>单屏</h3><h4 id="全部点亮-1"><a href="#全部点亮-1" class="headerlink" title="全部点亮"></a>全部点亮</h4><ul>
<li>通过动态扫描（刷新）全部点亮，检查是否坏点</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__sfr __at (<span class="number">0x94</span>) P0M0;</span><br><span class="line">__sfr __at (<span class="number">0x93</span>) P0M1;</span><br><span class="line">__sfr __at (<span class="number">0x92</span>) P1M0;</span><br><span class="line">__sfr __at (<span class="number">0x91</span>) P1M1;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 强推挽输出模式</span></span><br><span class="line">    P0M1 = <span class="number">0x00</span>;</span><br><span class="line">    P0M0 = <span class="number">0xFF</span>;</span><br><span class="line">    </span><br><span class="line">    P1M1 = <span class="number">0x00</span>;</span><br><span class="line">    P1M0 = <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义字模值</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>&#125;;</span><br><span class="line">    <span class="comment">// 定义列</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> l[] = &#123;<span class="number">0xFE</span>, <span class="number">0xFD</span>, <span class="number">0xFB</span>, <span class="number">0xF7</span>, <span class="number">0xEF</span>, <span class="number">0xDF</span>, <span class="number">0xBF</span>, <span class="number">0x7F</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            P0 = l[i]; <span class="comment">// 选列</span></span><br><span class="line">            P1 = num[i]; <span class="comment">// 送行</span></span><br><span class="line">            delay(<span class="number">2</span>); <span class="comment">// 延迟</span></span><br><span class="line">            P1 = <span class="number">0xFF</span>; <span class="comment">// 灭行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="双屏"><a href="#双屏" class="headerlink" title="双屏"></a>双屏</h3><h4 id="全部点亮-2"><a href="#全部点亮-2" class="headerlink" title="全部点亮"></a>全部点亮</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__sfr __at (<span class="number">0x94</span>) P0M0;</span><br><span class="line">__sfr __at (<span class="number">0x93</span>) P0M1;</span><br><span class="line">__sfr __at (<span class="number">0x92</span>) P1M0;</span><br><span class="line">__sfr __at (<span class="number">0x91</span>) P1M1;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 强推挽输出模式</span></span><br><span class="line">    P0M1 = <span class="number">0x00</span>;</span><br><span class="line">    P0M0 = <span class="number">0xFF</span>;</span><br><span class="line">    </span><br><span class="line">    P1M1 = <span class="number">0x00</span>;</span><br><span class="line">    P1M0 = <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义字模值</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> num[] = &#123;<span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>&#125;;</span><br><span class="line">    <span class="comment">// 定义列</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> l[] = &#123;<span class="number">0xFE</span>, <span class="number">0xFD</span>, <span class="number">0xFB</span>, <span class="number">0xF7</span>, <span class="number">0xEF</span>, <span class="number">0xDF</span>, <span class="number">0xBF</span>, <span class="number">0x7F</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">8</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                P2 = <span class="number">0xFF</span>;</span><br><span class="line">                P0 = l[i]; <span class="comment">// 选列</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                P0 = <span class="number">0xFF</span>;</span><br><span class="line">                P2 = l[i]; <span class="comment">// 选列</span></span><br><span class="line">            &#125;</span><br><span class="line">            P1 = num[i]; <span class="comment">// 送行</span></span><br><span class="line">            delay(<span class="number">1</span>); <span class="comment">// 延迟</span></span><br><span class="line">            P1 = <span class="number">0xFF</span>; <span class="comment">// 灭行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="蜂鸣器（Buzz）"><a href="#蜂鸣器（Buzz）" class="headerlink" title="蜂鸣器（Buzz）"></a>蜂鸣器（Buzz）</h2><ul>
<li><p>有源蜂鸣器：内置了震荡源芯片的蜂鸣器，接上电点就能响，但是不能改变振动频率所以只能发出一种音调</p>
</li>
<li><p>无源蜂鸣器：没有内置震荡源芯片的蜂鸣器，接上电后，需要给脉冲信号才能响，可以通过改变震动频发出不同的音调</p>
</li>
<li><p>拉电流和灌电流都可以使蜂鸣器发声</p>
<ul>
<li>本案例接线方式<ul>
<li>灌电流。蜂鸣器一端接P1.0</li>
</ul>
</li>
</ul>
</li>
<li><p>因为人耳识别声音的范围为5Hz~20kHz，所以延迟最大为100ms</p>
</li>
</ul>
<h3 id="软件延迟实现蜂鸣器5Hz声音"><a href="#软件延迟实现蜂鸣器5Hz声音" class="headerlink" title="软件延迟实现蜂鸣器5Hz声音"></a>软件延迟实现蜂鸣器5Hz声音</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    P0_0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        P0_0 = ~P0_0;</span><br><span class="line">        delay(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时-x2F-计数器实现蜂鸣器500Hz声音"><a href="#定时-x2F-计数器实现蜂鸣器500Hz声音" class="headerlink" title="定时&#x2F;计数器实现蜂鸣器500Hz声音"></a>定时&#x2F;计数器实现蜂鸣器500Hz声音</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指定开启定时计数器0中断</span></span><br><span class="line">    IE = <span class="number">0x82</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定模式</span></span><br><span class="line">    <span class="comment">// 指定门控信号为软件开启</span></span><br><span class="line">    <span class="comment">// 指定工作在定时模式</span></span><br><span class="line">    <span class="comment">// 指定工作方式3</span></span><br><span class="line">    TMOD = <span class="number">0x01</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定时间初值（1ms=1000次）</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0开启计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// 初始蜂鸣器</span></span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">timer0</span><span class="params">(<span class="type">void</span>)</span> __interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 阻止计数</span></span><br><span class="line">    TR0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务代码</span></span><br><span class="line">    <span class="keyword">if</span> (P1_0) P1_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新指定计数初值</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 恢复计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时-x2F-计数器实现蜂鸣器指定频率声音"><a href="#定时-x2F-计数器实现蜂鸣器指定频率声音" class="headerlink" title="定时&#x2F;计数器实现蜂鸣器指定频率声音"></a>定时&#x2F;计数器实现蜂鸣器指定频率声音</h3><blockquote>
<p><code>&lt;frequency&gt;</code>：频率</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指定开启定时计数器0中断</span></span><br><span class="line">    IE = <span class="number">0x82</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定模式</span></span><br><span class="line">    <span class="comment">// 指定门控信号为软件开启</span></span><br><span class="line">    <span class="comment">// 指定工作在定时模式</span></span><br><span class="line">    <span class="comment">// 指定工作方式3</span></span><br><span class="line">    TMOD = <span class="number">0x01</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定时间初值（1ms=1000次）</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0开启计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// 初始蜂鸣器</span></span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">timer0</span><span class="params">(<span class="type">void</span>)</span> __interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 阻止计数</span></span><br><span class="line">    TR0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务代码</span></span><br><span class="line">    <span class="keyword">if</span> (P1_0) P1_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新指定计数初值</span></span><br><span class="line">    TH0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) / <span class="number">256</span>;</span><br><span class="line">    TL0 = (<span class="number">65536</span> - <span class="number">1000000</span>/&lt;frequency&gt;/<span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">    <span class="comment">// 恢复计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定时-x2F-计数器实现蜂鸣器音阶"><a href="#定时-x2F-计数器实现蜂鸣器音阶" class="headerlink" title="定时&#x2F;计数器实现蜂鸣器音阶"></a>定时&#x2F;计数器实现蜂鸣器音阶</h3><ul>
<li>全音符的音长大约在1600ms</li>
<li>2分音符的音长大约在800ms</li>
<li>4分音符的音长大约在400ms（~600ms）</li>
<li>8分音符的音长大约在200ms</li>
<li>16分音符的音长大约在100ms</li>
<li>32分音符的音长大约在50ms</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;8052.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 存放寄存器高位</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> h;</span><br><span class="line"><span class="comment">// 存放寄存器低位</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> l;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指定开启定时计数器0中断</span></span><br><span class="line">    IE = <span class="number">0x82</span>;</span><br><span class="line">    <span class="comment">// 为定时/计数器0指定模式</span></span><br><span class="line">    <span class="comment">// 指定门控信号为软件开启</span></span><br><span class="line">    <span class="comment">// 指定工作在定时模式</span></span><br><span class="line">    <span class="comment">// 指定工作方式3</span></span><br><span class="line">    TMOD = <span class="number">0x01</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> ms)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (ms--)</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">600</span>; j &gt; <span class="number">0</span>; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="comment">// 初始蜂鸣器</span></span><br><span class="line">    P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C大调中音7音阶数组</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> pitch[] = &#123;<span class="number">523</span>, <span class="number">587</span>, <span class="number">659</span>, <span class="number">698</span>, <span class="number">784</span>, <span class="number">880</span>, <span class="number">988</span>&#125;;</span><br><span class="line">    <span class="comment">// 每次蜂鸣器发声的音调（C大调中音7音阶数组的索引）</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> tone[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="comment">// 每次蜂鸣器发声的音长（4分音符的倍数）</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> rhythm[] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="comment">// 累加器</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        h = (<span class="number">65536</span> - <span class="number">1000000</span>/pitch[tone[i] - <span class="number">1</span>]/<span class="number">2</span>) / <span class="number">256</span>;</span><br><span class="line">        l = (<span class="number">65536</span> - <span class="number">1000000</span>/pitch[tone[i] - <span class="number">1</span>]/<span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">        <span class="comment">// 为定时/计数器0指定时间初值（1ms=1000次）</span></span><br><span class="line">        TH0 = h;</span><br><span class="line">        TL0 = l;</span><br><span class="line">        <span class="comment">// 为定时/计数器0开启计数</span></span><br><span class="line">        TR0 = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 延迟总音长（4分音符的倍数 * 4分音符的音长）</span></span><br><span class="line">        delay(rhythm[i] * <span class="number">600</span>);</span><br><span class="line">        <span class="comment">// 为定时/计数器0关闭计数</span></span><br><span class="line">        TR0 = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 蜂鸣器断电</span></span><br><span class="line">        P1_0 = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 累加器增加</span></span><br><span class="line">        i += <span class="number">1</span>;</span><br><span class="line">        i %= <span class="keyword">sizeof</span>(tone)/<span class="keyword">sizeof</span>(tone[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">timer0</span><span class="params">(<span class="type">void</span>)</span> __interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 阻止计数</span></span><br><span class="line">    TR0 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务代码</span></span><br><span class="line">    <span class="keyword">if</span> (P1_0) P1_0 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> P1_0 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重新指定计数初值</span></span><br><span class="line">    TH0 = h;</span><br><span class="line">    TL0 = l;</span><br><span class="line">    <span class="comment">// 恢复计数</span></span><br><span class="line">    TR0 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="C大调音符频率对照表"><a href="#C大调音符频率对照表" class="headerlink" title="C大调音符频率对照表"></a>C大调音符频率对照表</h4><ul>
<li>中音的频率约定于2倍的低音</li>
<li>高音的频率约定于2倍的中音</li>
<li>以此类推</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>音符</th>
<th>频率</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>低音1</td>
<td>262</td>
</tr>
<tr>
<td>2</td>
<td>低音2</td>
<td>294</td>
</tr>
<tr>
<td>3</td>
<td>低音3</td>
<td>330</td>
</tr>
<tr>
<td>4</td>
<td>低音4</td>
<td>349</td>
</tr>
<tr>
<td>5</td>
<td>低音5</td>
<td>392</td>
</tr>
<tr>
<td>6</td>
<td>低音6</td>
<td>440</td>
</tr>
<tr>
<td>7</td>
<td>低音7</td>
<td>494</td>
</tr>
<tr>
<td>8</td>
<td>中音1</td>
<td>523</td>
</tr>
<tr>
<td>9</td>
<td>中音2</td>
<td>587</td>
</tr>
<tr>
<td>10</td>
<td>中音3</td>
<td>659</td>
</tr>
<tr>
<td>11</td>
<td>中音4</td>
<td>698</td>
</tr>
<tr>
<td>12</td>
<td>中音5</td>
<td>784</td>
</tr>
<tr>
<td>13</td>
<td>中音6</td>
<td>880</td>
</tr>
<tr>
<td>14</td>
<td>中音7</td>
<td>988</td>
</tr>
<tr>
<td>15</td>
<td>高音1</td>
<td>1046</td>
</tr>
<tr>
<td>16</td>
<td>高音2</td>
<td>1175</td>
</tr>
<tr>
<td>17</td>
<td>高音3</td>
<td>1318</td>
</tr>
<tr>
<td>18</td>
<td>高音4</td>
<td>1397</td>
</tr>
<tr>
<td>19</td>
<td>高音5</td>
<td>1568</td>
</tr>
<tr>
<td>20</td>
<td>高音6</td>
<td>1760</td>
</tr>
<tr>
<td>21</td>
<td>高音7</td>
<td>1976</td>
</tr>
</tbody></table>
<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="/302.html?target=https://www.bilibili.com/video/BV1Mb411e7re/">哔哩哔哩——江科大自化协</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Microcontroller/">Microcontroller</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 绯鞠
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>